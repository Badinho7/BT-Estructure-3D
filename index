<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>BT-Estructure — Demo WebXR Completa</title>
  <meta name="description" content="Visualización interactiva WebXR de la Teoría BT-Estructure. Compatible con Meta Quest (Browser).">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/protyze/aframe-curve-component@master/dist/aframe-curve-component.min.js"></script>
  <script src="scene.js"></script>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: #000; color: #fff; }
    #overlay {
      position: absolute; left: 10px; top: 10px; z-index: 9999;
      background: rgba(10,10,10,0.75); padding: 12px; border-radius: 8px;
      color: #eee; max-width: 420px; font-size: 14px;
      backdrop-filter: blur(4px);
    }
    .btn { margin:6px 4px 0 0; padding:8px 12px; background:#8e44ad; border:none; color:white; border-radius:6px; cursor:pointer; }
    .btn.secondary { background:#444; }
    .toggle { display:inline-block; margin-right:8px; }
    label { font-size:13px; }
    .small { font-size:12px; color:#ccc; margin-top:6px; }
  </style>
</head>
<body>
  <div id="overlay" role="dialog" aria-label="Controles">
    <h3 style="margin:0 0 6px 0">BT-Estructure — Demo VR completa</h3>
    <div><strong>Autor:</strong> Badi Bolaños Santiago</div>
    <p class="small">Versión demo: escena interactiva optimizada para Meta Quest Browser. Usa <strong>Enter VR</strong> para entrar en inmersión.</p>

    <div style="margin-top:8px;">
      <button class="btn" id="start-tour" onclick="startTour()">Iniciar tour</button>
      <button class="btn secondary" id="stop-tour" onclick="stopTour()">Detener tour</button>
    </div>

    <div style="margin-top:8px;">
      <div><label><input id="toggle-geodesics" class="toggle" type="checkbox" checked>Geodésicas</label></div>
      <div><label><input id="toggle-orbits" class="toggle" type="checkbox" checked>Órbitas</label></div>
      <div><label><input id="toggle-panels" class="toggle" type="checkbox" checked>Paneles informativos</label></div>
      <div><label><input id="toggle-narration" class="toggle" type="checkbox">Narración (activar en audio)</label></div>
    </div>

    <p class="small">Consejo: si usas Quest 3, activa el modo VR desde el navegador. Usa el joystick para moverte y el gatillo para interactuar con paneles si se muestran.</p>
  </div>

  <a-scene background="color: #000011" embedded vr-mode-ui="enterVRButton: true">
    <!-- Rig / camera -->
    <a-entity id="rig" position="0 1.6 8">
      <a-entity id="camera" camera look-controls wasd-controls="acceleration: 20"></a-entity>
      <a-entity id="leftHand" hand-controls="left"></a-entity>
      <a-entity id="rightHand" hand-controls="right"></a-entity>
    </a-entity>

    <!-- Lights -->
    <a-entity light="type: ambient; color: #666"></a-entity>
    <a-entity light="type: point; intensity: 2; distance: 80; color: #c7a3ff" position="0 12 12"></a-entity>

    <!-- Sky -->
    <a-sky color="#020012"></a-sky>

    <!-- Central small black hole (visual representation) -->
    <a-entity id="smallBH" geometry="primitive: sphere; radius: 0.8" material="color: #020202; metalness:0.9; roughness:0.6" position="0 0 0">
      <a-ring position="0 0 0.01" rotation="-90 0 0" radius-inner="1.1" radius-outer="1.6" material="color:#6600ff; shader:flat; opacity:0.06"></a-ring>
    </a-entity>

    <!-- Orbit groups -->
    <a-entity id="orbitA" position="0 0 0">
      <a-entity id="bigA" geometry="primitive: sphere; radius: 1.6" material="color:#130014; metalness:0.9; roughness:0.4" position="5 0 0"></a-entity>
    </a-entity>
    <a-entity id="orbitB" position="0 0 0">
      <a-entity id="bigB" geometry="primitive: sphere; radius: 1.9" material="color:#140018; metalness:0.9; roughness:0.4" position="-7 0 0"></a-entity>
    </a-entity>

    <!-- Accretion discs -->
    <a-entity id="discA" geometry="primitive: torus; radius: 1.9; radiusTubular:0.12" rotation="-90 0 0" material="color:#3b0d4a; opacity:0.75" position="5 0 0"></a-entity>
    <a-entity id="discB" geometry="primitive: torus; radius: 2.3; radiusTubular:0.15" rotation="-90 0 0" material="color:#2d0b3a; opacity:0.78" position="-7 0 0"></a-entity>

    <!-- Geodesics placeholder parent -->
    <a-entity id="geodesics"></a-entity>

    <!-- Orbit visible lines -->
    <a-entity id="orbitLines"></a-entity>

    <!-- Informational panels (toggleable) -->
    <a-entity id="panelRoot">
      <a-entity id="panel1" position="3.2 2.4 -2.6" rotation="-20 30 0">
        <a-plane width="2.4" height="1.1" color="#0f0f12" material="opacity:0.88"></a-plane>
        <a-entity position="-1 0.3 0.01" text="value: BT-Estructure (Bolaños); color:#e9d6ff; width:1.9; wrapCount:30"></a-entity>
        <a-entity position="-1 -0.05 0.01" text="value: Dos supermasivos orbitando y un tercero en el eje; color:#ffffff; width:1.9; wrapCount:30"></a-entity>
      </a-entity>

      <a-entity id="panel2" position="-4 2.6 -1.8" rotation="-18 12 0">
        <a-plane width="2.4" height="1.1" color="#0f0f12" material="opacity:0.88"></a-plane>
        <a-entity position="-1 0.3 0.01" text="value: Geodésicas; color:#e9d6ff; width:1.9; wrapCount:30"></a-entity>
        <a-entity position="-1 -0.05 0.01" text="value: Estiradas y comprimidas alrededor de la garganta; color:#ffffff; width:1.9; wrapCount:30"></a-entity>
      </a-entity>
    </a-entity>

    <!-- Floor plane for spatial reference -->
    <a-plane position="0 -2 0" rotation="-90 0 0" width="70" height="70" color="#020012" material="side:double"></a-plane>

    <!-- Audio source (narration placeholder) -->
    <a-entity id="narration" position="0 0 0">
      <a-sound id="narr" src="#narrAudio" autoplay="false" positional="true" distanceModel="inverse" maxDistance="40"></a-sound>
    </a-entity>
    <audio id="narrAudio" src="narration.wav"></audio>

  </a-scene>

  <script>
    // expose toggles and simple functions tied to HTML controls
    document.addEventListener('DOMContentLoaded', function(){
      const geos = document.getElementById('geodesics');
      const orbits = document.getElementById('orbitLines');
      const panels = document.getElementById('panelRoot');
      const narrChk = document.getElementById('toggle-narration');
      const audioEl = document.getElementById('narrAudio');

      document.getElementById('toggle-geodesics').addEventListener('change', (e)=>{
        geos.object3D.visible = e.target.checked;
      });
      document.getElementById('toggle-orbits').addEventListener('change', (e)=>{
        orbits.object3D.visible = e.target.checked;
      });
      document.getElementById('toggle-panels').addEventListener('change', (e)=>{
        panels.object3D.visible = e.target.checked;
      });
      document.getElementById('toggle-narration').addEventListener('change', (e)=>{
        if (e.target.checked) {
          audioEl.play();
        } else {
          audioEl.pause();
          audioEl.currentTime = 0;
        }
      });
    });

    // Simple start/stop tour triggers (buttons call these)
    window.startTour = function(){ window.dispatchEvent(new CustomEvent('start-tour')); };
    window.stopTour = function(){ window.dispatchEvent(new CustomEvent('stop-tour')); };
  </script>

</body>
</html>
